{"version":3,"sources":["webpack:///./src/redeem/RedeemDialog.js","webpack:///./src/firebase/index.js","webpack:///./src/redeem/index.js"],"names":["RedeemDialog","_ref","onClose","react_default","a","createElement","dist_esm","actions","text","onClick","heading","onCloseComplete","shouldCloseOnOverlayClick","RedeemDialog_RedeemDialogContent","index_cjs_default","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","Object","assign","window","firebase","state","status","error","code","admin","n","signIn","_callee","result","uid","document","data","regenerator_default","wrap","_context","prev","next","_this","setState","auth","signInWithPopup","GithubAuthProvider","sent","t0","catch","abrupt","user","providerData","firestore","collection","doc","get","t1","t2","stop","this","openEventPop","open","giveCode","_callee2","username","id","redemptionCode","_context2","prompt","alert","axios_default","Error","String","set","merge","t","m","prototype","render","className","index_es","css","color","renderSignInPage","loading","Preloader","adminPanel","esm","iconAfter","Icon","angle_right_default","appearance","_ref4","isLoading","size","iconBefore","github_default","d","e","Component","_ref5","display","verticalAlign","spinner_dist_esm","_ref6","children","fontSize","renderDialog"],"mappings":"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","file":"redeem-54576a3d099f97f7fae8.js","sourcesContent":["import React from 'react'\nimport GitHubIcon from 'react-icons/lib/fa/github'\nimport ArrowForward from 'react-icons/lib/fa/angle-right'\nimport Button from '@atlaskit/button'\nimport ModalDialog from '@atlaskit/modal-dialog'\nimport Spinner from '@atlaskit/spinner'\nimport axios from 'axios'\n\nimport { firebase } from '../firebase'\n\nexport function RedeemDialog ({ onClose }) {\n  return (\n    <ModalDialog\n      actions={[{ text: 'Close', onClick: onClose }]}\n      heading=\"Redeem ticket\"\n      onCloseComplete={onClose}\n      shouldCloseOnOverlayClick={false}\n    >\n      <RedeemDialogContent />\n    </ModalDialog>\n  )\n}\n\nclass RedeemDialogContent extends React.Component {\n  state = {\n    status: 'initial',\n    error: '',\n    code: '',\n    admin: false,\n  }\n\n  render () {\n    if (this.state.status === 'error') {\n      return (\n        <div>\n          <p css={{ color: 'red' }}>\n            <strong>Error:</strong> {this.state.error}\n          </p>\n        </div>\n      )\n    }\n    if (this.state.status === 'signingIn') {\n      return this.renderSignInPage({ loading: true })\n    }\n    if (this.state.status === 'checking') {\n      return <Preloader text=\"Looking for your ticket...\" />\n    }\n    if (this.state.status === 'checked') {\n      const adminPanel = this.state.admin && (\n        <div>\n          <p>\n            Hey you are an admin! You can{' '}\n            <Button onClick={this.giveCode}>give redemption codes!</Button>\n          </p>\n        </div>\n      )\n      if (!this.state.code) {\n        return (\n          <div>\n            <p>Sorry, we cannot find the ticket associated with your account...</p>\n            {adminPanel}\n          </div>\n        )\n      }\n      return (\n        <div>\n          <p>Congratulations! You receive a free ticket.</p>\n          <p>\n            Use the code <strong>{this.state.code}</strong> to redeem your free ticket.\n          </p>\n          <Button\n            iconAfter={\n              <Icon>\n                <ArrowForward />\n              </Icon>\n            }\n            appearance=\"primary\"\n            onClick={this.openEventPop}\n          >\n            Get your free ticket! (Go to Event Pop)\n          </Button>\n          {adminPanel}\n        </div>\n      )\n    }\n    return this.renderSignInPage({ loading: false })\n  }\n\n  renderSignInPage ({ loading }) {\n    return (\n      <div>\n        <p>To redeem your ticket, please first sign in with GitHub...</p>\n        <Button\n          isLoading={loading}\n          appearance=\"primary\"\n          size=\"large\"\n          iconBefore={\n            <Icon>\n              <GitHubIcon />\n            </Icon>\n          }\n          onClick={loading ? undefined : this.signIn}\n        >\n          Sign in with GitHub\n        </Button>\n      </div>\n    )\n  }\n\n  signIn = async () => {\n    this.setState({ status: 'signingIn' })\n    try {\n      let result\n      try {\n        result = await firebase.auth().signInWithPopup(new firebase.auth.GithubAuthProvider())\n      } catch (e) {\n        this.setState({ status: 'error', error: `Cannot sign in: ${e}` })\n        return\n      }\n      const uid = result.user.providerData[0].uid\n      let document\n      this.setState({ status: 'checking' })\n      try {\n        document = await firebase\n          .firestore()\n          .collection('github_users')\n          .doc(uid)\n          .get()\n      } catch (e) {\n        this.setState({ status: 'error', error: `Cannot check: ${e}` })\n        return\n      }\n      const data = document.data()\n      this.setState({ status: 'checked', code: data && data.code, admin: data && data.admin })\n    } catch (e) {\n      this.setState({ status: 'error', error: `Unknown error: ${e}` })\n    }\n  }\n\n  openEventPop = () => {\n    window.open('https://www.eventpop.me/e/3607-react-bangkok-3-0-0', '_blank')\n  }\n\n  giveCode = async () => {\n    const username = window.prompt('Enter GitHub username')\n    if (!username) {\n      window.alert('Aborting.')\n      return\n    }\n    try {\n      const data = (await axios.get(`https://api.github.com/users/${username}`)).data\n      if (!data) throw new Error('No response from GitHub')\n      if (!data.id) throw new Error('No user ID data found')\n      const id = data.id\n      window.alert(`Found GitHub user id = ${id}.`)\n      const redemptionCode = window.prompt('Enter redemption code')\n      if (!redemptionCode) {\n        window.alert('Aborting.')\n        return\n      }\n      await firebase\n        .firestore()\n        .collection('github_users')\n        .doc(String(id))\n        .set(\n          {\n            code: redemptionCode,\n            username,\n          },\n          { merge: true }\n        )\n      window.alert(`OK done.\\n\\nusername=${username}\\nid=${id}\\ncode=${redemptionCode}`)\n    } catch (e) {\n      window.alert(`Cannot giveCode: ${e}.`)\n    }\n  }\n}\n\nfunction Preloader ({ text }) {\n  return (\n    <div>\n      <span css={{ display: 'inline-block', verticalAlign: 'middle' }}>\n        <Spinner />\n      </span>{' '}\n      {text}\n    </div>\n  )\n}\n\nfunction Icon ({ children }) {\n  return <span css={{ fontSize: '1rem' }}>{children}</span>\n}\n","import firebase from 'firebase/app'\nimport 'firebase/auth'\nimport 'firebase/firestore'\n\nconst config = {\n  apiKey: 'AIzaSyCNk1PljsNsYRgvZ98_KYVqotkRojt24kk',\n  authDomain: 'reactbkk3.firebaseapp.com',\n  databaseURL: 'https://reactbkk3.firebaseio.com',\n  projectId: 'reactbkk3',\n  storageBucket: 'reactbkk3.appspot.com',\n  messagingSenderId: '666406395956',\n}\nfirebase.initializeApp(config)\n\n// For debugging.\nObject.assign(window, { firebase })\n\nexport { firebase }\n","import React from 'react'\nimport { RedeemDialog } from './RedeemDialog'\n\nexport function renderDialog ({ onClose }) {\n  return <RedeemDialog onClose={onClose} />\n}\n"],"sourceRoot":""}