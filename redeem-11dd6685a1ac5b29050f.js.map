{"version":3,"sources":["webpack:///./src/redeem/RedeemDialog.js","webpack:///./src/firebase/index.js","webpack:///./src/redeem/index.js"],"names":["RedeemDialog","_ref","onClose","react_default","a","createElement","dist","Dialog","haveCloseButton","backdrop","title","buttons","text","onPress","open","closeOnEscape","RedeemDialog_RedeemDialogContent","index_cjs_default","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","Object","assign","window","firebase","state","status","error","code","admin","n","signIn","_callee","result","uid","document","data","regenerator_default","wrap","_context","prev","next","_this","setState","auth","signInWithPopup","GithubAuthProvider","sent","t0","catch","abrupt","user","providerData","firestore","collection","doc","get","t1","t2","stop","this","openEventPop","giveCode","_callee2","username","id","redemptionCode","_context2","prompt","alert","axios_default","Error","String","set","merge","t","m","prototype","render","className","index_es","css","color","Preloader","kind","labelAlign","subtitle","indeterminate","adminPanel","Button","colorScheme","iconPositionRight","icon","angle_right_default","size","github_default","Component","renderDialog"],"mappings":"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","file":"redeem-11dd6685a1ac5b29050f.js","sourcesContent":["import { Dialog, Button, Preloader } from 'reactackle'\nimport React from 'react'\nimport GitHubIcon from 'react-icons/lib/fa/github'\nimport ArrowForward from 'react-icons/lib/fa/angle-right'\nimport axios from 'axios'\n\nimport { firebase } from '../firebase'\n\nexport function RedeemDialog ({ onClose }) {\n  return (\n    <Dialog\n      haveCloseButton\n      backdrop\n      title=\"Redeem ticket\"\n      buttons={[{ text: 'Close', onPress: onClose }]}\n      open\n      closeOnEscape\n      onClose={onClose}\n    >\n      <RedeemDialogContent />\n    </Dialog>\n  )\n}\n\nclass RedeemDialogContent extends React.Component {\n  state = {\n    status: 'initial',\n    error: '',\n    code: '',\n    admin: false,\n  }\n\n  render () {\n    if (this.state.status === 'error') {\n      return (\n        <div>\n          <p css={{ color: 'red' }}>\n            <strong>Error:</strong> {this.state.error}\n          </p>\n        </div>\n      )\n    }\n    if (this.state.status === 'signingIn') {\n      return <Preloader kind=\"linear\" labelAlign=\"center\" subtitle=\"Signing in...\" indeterminate />\n    }\n    if (this.state.status === 'checking') {\n      return (\n        <Preloader\n          kind=\"linear\"\n          labelAlign=\"center\"\n          subtitle=\"Looking for your ticket...\"\n          indeterminate\n        />\n      )\n    }\n    if (this.state.status === 'checked') {\n      const adminPanel = this.state.admin && (\n        <div>\n          <p>\n            Hey you are an admin! You can{' '}\n            <Button onPress={this.giveCode} text=\"give redemption codes!\" />\n          </p>\n        </div>\n      )\n      if (!this.state.code) {\n        return (\n          <div>\n            <p>Sorry, we cannot find the ticket associated with your account...</p>\n            {adminPanel}\n          </div>\n        )\n      }\n      return (\n        <div>\n          <p>Congratulations! You receive a free ticket.</p>\n          <p>\n            Use the code <strong>{this.state.code}</strong> to redeem your free ticket.\n          </p>\n          <Button\n            text=\"Get your free ticket!\"\n            subtitle=\"Go to Event Pop\"\n            colorScheme=\"primary\"\n            iconPositionRight\n            icon={<ArrowForward />}\n            onPress={this.openEventPop}\n          />\n          {adminPanel}\n        </div>\n      )\n    }\n    return (\n      <div>\n        <p>To redeem your ticket, please first sign in with GitHub...</p>\n        <Button\n          text=\"Sign in with GitHub\"\n          colorScheme=\"primary\"\n          size=\"large\"\n          icon={<GitHubIcon />}\n          onPress={this.signIn}\n        />\n      </div>\n    )\n  }\n\n  signIn = async () => {\n    this.setState({ status: 'signingIn' })\n    try {\n      let result\n      try {\n        result = await firebase.auth().signInWithPopup(new firebase.auth.GithubAuthProvider())\n      } catch (e) {\n        this.setState({ status: 'error', error: `Cannot sign in: ${e}` })\n        return\n      }\n      const uid = result.user.providerData[0].uid\n      let document\n      this.setState({ status: 'checking' })\n      try {\n        document = await firebase\n          .firestore()\n          .collection('github_users')\n          .doc(uid)\n          .get()\n      } catch (e) {\n        this.setState({ status: 'error', error: `Cannot check: ${e}` })\n        return\n      }\n      const data = document.data()\n      this.setState({ status: 'checked', code: data && data.code, admin: data && data.admin })\n    } catch (e) {\n      this.setState({ status: 'error', error: `Unknown error: ${e}` })\n    }\n  }\n\n  openEventPop = () => {\n    window.open('https://www.eventpop.me/e/3607-react-bangkok-3-0-0', '_blank')\n  }\n\n  giveCode = async () => {\n    const username = window.prompt('Enter GitHub username')\n    if (!username) {\n      window.alert('Aborting.')\n      return\n    }\n    try {\n      const data = (await axios.get(`https://api.github.com/users/${username}`)).data\n      if (!data) throw new Error('No response from GitHub')\n      if (!data.id) throw new Error('No user ID data found')\n      const id = data.id\n      window.alert(`Found GitHub user id = ${id}.`)\n      const redemptionCode = window.prompt('Enter redemption code')\n      if (!redemptionCode) {\n        window.alert('Aborting.')\n        return\n      }\n      await firebase\n        .firestore()\n        .collection('github_users')\n        .doc(String(id))\n        .set(\n          {\n            code: redemptionCode,\n            username,\n          },\n          { merge: true }\n        )\n      window.alert(`OK done.\\n\\nusername=${username}\\nid=${id}\\ncode=${redemptionCode}`)\n    } catch (e) {\n      window.alert(`Cannot giveCode: ${e}.`)\n    }\n  }\n}\n","import firebase from 'firebase/app'\nimport 'firebase/auth'\nimport 'firebase/firestore'\n\nconst config = {\n  apiKey: 'AIzaSyCNk1PljsNsYRgvZ98_KYVqotkRojt24kk',\n  authDomain: 'reactbkk3.firebaseapp.com',\n  databaseURL: 'https://reactbkk3.firebaseio.com',\n  projectId: 'reactbkk3',\n  storageBucket: 'reactbkk3.appspot.com',\n  messagingSenderId: '666406395956',\n}\nfirebase.initializeApp(config)\n\n// For debugging.\nObject.assign(window, { firebase })\n\nexport { firebase }\n","import React from 'react'\nimport { RedeemDialog } from './RedeemDialog'\n\nexport function renderDialog ({ onClose }) {\n  return <RedeemDialog onClose={onClose} />\n}\n"],"sourceRoot":""}