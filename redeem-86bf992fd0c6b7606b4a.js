(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{405:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),i=n(239),o=n(257),s=n.n(o),c=(n(248),n(256)),u=n.n(c),l=n(82),d=n.n(l),p=n(254),m=n.n(p),h=n(374),g=n.n(h),k=n(373),v=n.n(k),f=n(260),w=n(295),b=n(259),E=n(325),C=n.n(E),x=(n(90),n(262)),y=n.n(x);function S(e){var t=e.onClose;return a.a.createElement(w.a,{actions:[{text:"Close",onClick:t}],heading:"Redeem ticket",onCloseComplete:t,shouldCloseOnOverlayClick:!1},a.a.createElement(I,null))}n(301),n(299),y.a.initializeApp({apiKey:"AIzaSyCNk1PljsNsYRgvZ98_KYVqotkRojt24kk",authDomain:"reactbkk3.firebaseapp.com",databaseURL:"https://reactbkk3.firebaseio.com",projectId:"reactbkk3",storageBucket:"reactbkk3.appspot.com",messagingSenderId:"666406395956"}),Object.assign(window,{firebase:y.a});var I=function(e){function t(){for(var t,n,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return t=n=e.call.apply(e,[this].concat(a))||this,n.state={status:"initial",error:"",code:"",admin:!1},n.signIn=u()(s.a.mark(function e(){var t,r,a,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({status:"signingIn"}),e.prev=1,e.prev=2,e.next=5,y.a.auth().signInWithPopup(new y.a.auth.GithubAuthProvider);case 5:t=e.sent,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(2),n.setState({status:"error",error:"Cannot sign in: "+e.t0}),e.abrupt("return");case 12:return r=t.user.providerData[0].uid,n.setState({status:"checking"}),e.prev=14,e.next=17,y.a.firestore().collection("github_users").doc(r).get();case 17:a=e.sent,e.next=24;break;case 20:return e.prev=20,e.t1=e.catch(14),n.setState({status:"error",error:"Cannot check: "+e.t1}),e.abrupt("return");case 24:i=a.data(),n.setState({status:"checked",code:i&&i.code,admin:i&&i.admin}),e.next=31;break;case 28:e.prev=28,e.t2=e.catch(1),n.setState({status:"error",error:"Unknown error: "+e.t2});case 31:case"end":return e.stop()}},e,this,[[1,28],[2,8],[14,20]])})),n.openEventPop=function(){window.open("https://www.eventpop.me/e/3607-react-bangkok-3-0-0","_blank")},n.giveCode=u()(s.a.mark(function e(){var t,n,r,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=window.prompt("Enter GitHub username")){e.next=4;break}return window.alert("Aborting."),e.abrupt("return");case 4:return e.prev=4,e.next=7,C.a.get("https://api.github.com/users/"+t);case 7:if(n=e.sent.data){e.next=10;break}throw new Error("No response from GitHub");case 10:if(n.id){e.next=12;break}throw new Error("No user ID data found");case 12:if(r=n.id,window.alert("Found GitHub user id = "+r+"."),a=window.prompt("Enter redemption code")){e.next=18;break}return window.alert("Aborting."),e.abrupt("return");case 18:return e.next=20,y.a.firestore().collection("github_users").doc(String(r)).set({code:a,username:t},{merge:!0});case 20:window.alert("OK done.\n\nusername="+t+"\nid="+r+"\ncode="+a),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(4),window.alert("Cannot giveCode: "+e.t0+".");case 26:case"end":return e.stop()}},e,this,[[4,23]])})),t||m()(n)}var n=t.prototype;return n.render=function(){if("error"===this.state.status)return a.a.createElement("div",null,a.a.createElement("p",{className:Object(i.css)({color:"red"})},a.a.createElement("strong",null,"Error:")," ",this.state.error));if("signingIn"===this.state.status)return this.renderSignInPage({loading:!0});if("checking"===this.state.status)return a.a.createElement(P,{text:"Looking for your ticket..."});if("checked"===this.state.status){var e=this.state.admin&&a.a.createElement("div",null,a.a.createElement("p",null,"Hey you are an admin! You can"," ",a.a.createElement(f.a,{onClick:this.giveCode},"give redemption codes!")));return this.state.code?a.a.createElement("div",null,a.a.createElement("p",null,"Congratulations! You receive a free ticket."),a.a.createElement("p",null,"Use the code ",a.a.createElement("strong",null,this.state.code)," to redeem your free ticket."),a.a.createElement(f.a,{iconAfter:a.a.createElement(A,null,a.a.createElement(v.a,null)),appearance:"primary",onClick:this.openEventPop},"Get your free ticket! (Go to Event Pop)"),e):a.a.createElement("div",null,a.a.createElement("p",null,"Sorry, we cannot find the ticket associated with your account..."),e)}return this.renderSignInPage({loading:!1})},n.renderSignInPage=function(e){var t=e.loading;return a.a.createElement("div",null,a.a.createElement("p",null,"To redeem your ticket, please first sign in with GitHub..."),a.a.createElement(f.a,{isLoading:t,appearance:"primary",size:"large",iconBefore:a.a.createElement(A,null,a.a.createElement(g.a,null)),onClick:t?void 0:this.signIn},"Sign in with GitHub"))},d()(t,e),t}(a.a.Component);function P(e){var t=e.text;return a.a.createElement("div",null,a.a.createElement("span",{className:Object(i.css)({display:"inline-block",verticalAlign:"middle"})},a.a.createElement(b.a,null))," ",t)}function A(e){var t=e.children;return a.a.createElement("span",{className:Object(i.css)({fontSize:"1rem"})},t)}function G(e){var t=e.onClose;return a.a.createElement(S,{onClose:t})}n.d(t,"renderDialog",function(){return G})}}]);
//# sourceMappingURL=redeem-86bf992fd0c6b7606b4a.js.map