{"version":3,"sources":["webpack:///./src/redeem/RedeemDialog.js","webpack:///./src/firebase/index.js","webpack:///./src/redeem/index.js"],"names":["RedeemDialog","_ref","onClose","initialState","react_default","a","createElement","dist_esm","actions","text","onClick","heading","onCloseComplete","shouldCloseOnOverlayClick","RedeemDialog_RedeemDialogContent","index_cjs_default","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","Object","assign","window","firebase","state","_this","props","status","error","code","admin","n","signIn","_callee","result","uid","document","data","regenerator_default","wrap","_context","prev","next","setState","auth","signInWithPopup","GithubAuthProvider","sent","t0","catch","abrupt","user","providerData","firestore","collection","doc","get","t1","t2","stop","this","openEventPop","open","giveCode","_callee2","username","id","redemptionCode","_context2","prompt","alert","axios_default","Error","String","set","merge","t","m","prototype","render","className","index_es","css","color","renderSignInPage","loading","Preloader","adminPanel","esm","iconAfter","Icon","angle_right_default","appearance","_ref4","isLoading","size","iconBefore","github_default","d","e","Component","_ref5","display","verticalAlign","spinner_dist_esm","_ref6","children","fontSize","renderDialog"],"mappings":"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","file":"redeem-ee46fdc56eee230049e4.js","sourcesContent":["import React from 'react'\nimport GitHubIcon from 'react-icons/lib/fa/github'\nimport ArrowForward from 'react-icons/lib/fa/angle-right'\nimport Button from '@atlaskit/button'\nimport ModalDialog from '@atlaskit/modal-dialog'\nimport Spinner from '@atlaskit/spinner'\nimport axios from 'axios'\n\nimport { firebase } from '../firebase'\n\nexport function RedeemDialog ({ onClose, initialState }) {\n  return (\n    <ModalDialog\n      actions={[{ text: 'Close', onClick: onClose }]}\n      heading=\"Redeem ticket\"\n      onCloseComplete={onClose}\n      shouldCloseOnOverlayClick={false}\n    >\n      <RedeemDialogContent initialState={initialState} />\n    </ModalDialog>\n  )\n}\n\nclass RedeemDialogContent extends React.Component {\n  state = this.props.initialState || {\n    status: 'initial',\n    error: '',\n    code: '',\n    admin: false,\n  }\n\n  render () {\n    if (this.state.status === 'error') {\n      return (\n        <div>\n          <p css={{ color: 'red' }}>\n            <strong>Error:</strong> {this.state.error}\n          </p>\n        </div>\n      )\n    }\n    if (this.state.status === 'signingIn') {\n      return this.renderSignInPage({ loading: true })\n    }\n    if (this.state.status === 'checking') {\n      return <Preloader text=\"Looking for your ticket...\" />\n    }\n    if (this.state.status === 'checked') {\n      const adminPanel = this.state.admin && (\n        <div>\n          <p>\n            Hey you are an admin! You can{' '}\n            <Button onClick={this.giveCode}>give redemption codes!</Button>\n          </p>\n        </div>\n      )\n      if (!this.state.code) {\n        return (\n          <div>\n            <p>Sorry, we cannot find the ticket associated with your account...</p>\n            {adminPanel}\n          </div>\n        )\n      }\n      return (\n        <div>\n          <p>Congratulations! You receive a free ticket.</p>\n          <p>\n            Use the code <strong>{this.state.code}</strong> to redeem your free ticket.\n          </p>\n          <Button\n            iconAfter={\n              <Icon>\n                <ArrowForward />\n              </Icon>\n            }\n            appearance=\"primary\"\n            onClick={this.openEventPop}\n          >\n            Get your free ticket! (Go to Event Pop)\n          </Button>\n          {adminPanel}\n        </div>\n      )\n    }\n    return this.renderSignInPage({ loading: false })\n  }\n\n  renderSignInPage ({ loading }) {\n    return (\n      <div>\n        <p>To redeem your ticket, please first sign in with GitHub...</p>\n        <Button\n          isLoading={loading}\n          appearance=\"primary\"\n          size=\"large\"\n          iconBefore={\n            <Icon>\n              <GitHubIcon />\n            </Icon>\n          }\n          onClick={loading ? undefined : this.signIn}\n        >\n          Sign in with GitHub\n        </Button>\n      </div>\n    )\n  }\n\n  signIn = async () => {\n    this.setState({ status: 'signingIn' })\n    try {\n      let result\n      try {\n        result = await firebase.auth().signInWithPopup(new firebase.auth.GithubAuthProvider())\n      } catch (e) {\n        this.setState({ status: 'error', error: `Cannot sign in: ${e}` })\n        return\n      }\n      const uid = result.user.providerData[0].uid\n      let document\n      this.setState({ status: 'checking' })\n      try {\n        document = await firebase\n          .firestore()\n          .collection('github_users')\n          .doc(uid)\n          .get()\n      } catch (e) {\n        this.setState({ status: 'error', error: `Cannot check: ${e}` })\n        return\n      }\n      const data = document.data()\n      this.setState({ status: 'checked', code: data && data.code, admin: data && data.admin })\n    } catch (e) {\n      this.setState({ status: 'error', error: `Unknown error: ${e}` })\n    }\n  }\n\n  openEventPop = () => {\n    window.open('https://www.eventpop.me/e/3607-react-bangkok-3-0-0', '_blank')\n  }\n\n  giveCode = async () => {\n    const username = window.prompt('Enter GitHub username')\n    if (!username) {\n      window.alert('Aborting.')\n      return\n    }\n    try {\n      const data = (await axios.get(`https://api.github.com/users/${username}`)).data\n      if (!data) throw new Error('No response from GitHub')\n      if (!data.id) throw new Error('No user ID data found')\n      const id = data.id\n      window.alert(`Found GitHub user id = ${id}.`)\n      const redemptionCode = window.prompt('Enter redemption code')\n      if (!redemptionCode) {\n        window.alert('Aborting.')\n        return\n      }\n      await firebase\n        .firestore()\n        .collection('github_users')\n        .doc(String(id))\n        .set(\n          {\n            code: redemptionCode,\n            username,\n          },\n          { merge: true }\n        )\n      window.alert(`OK done.\\n\\nusername=${username}\\nid=${id}\\ncode=${redemptionCode}`)\n    } catch (e) {\n      window.alert(`Cannot giveCode: ${e}.`)\n    }\n  }\n}\n\nfunction Preloader ({ text }) {\n  return (\n    <div>\n      <span css={{ display: 'inline-block', verticalAlign: 'middle' }}>\n        <Spinner />\n      </span>{' '}\n      {text}\n    </div>\n  )\n}\n\nfunction Icon ({ children }) {\n  return <span css={{ fontSize: '1rem' }}>{children}</span>\n}\n","import firebase from 'firebase/app'\nimport 'firebase/auth'\nimport 'firebase/firestore'\n\nconst config = {\n  apiKey: 'AIzaSyCNk1PljsNsYRgvZ98_KYVqotkRojt24kk',\n  authDomain: 'reactbkk3.firebaseapp.com',\n  databaseURL: 'https://reactbkk3.firebaseio.com',\n  projectId: 'reactbkk3',\n  storageBucket: 'reactbkk3.appspot.com',\n  messagingSenderId: '666406395956',\n}\nfirebase.initializeApp(config)\n\n// For debugging.\nObject.assign(window, { firebase })\n\nexport { firebase }\n","import React from 'react'\nimport { RedeemDialog } from './RedeemDialog'\n\nexport function renderDialog ({ onClose }) {\n  return <RedeemDialog onClose={onClose} />\n}\n"],"sourceRoot":""}